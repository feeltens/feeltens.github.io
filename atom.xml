<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>feeltens</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.feeltens.com/"/>
  <updated>2020-11-21T05:36:36.761Z</updated>
  <id>http://www.feeltens.com/</id>
  
  <author>
    <name>feeltens</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>macOS Big Sur 升级记录</title>
    <link href="http://www.feeltens.com/macos-big-sur-upgrade/"/>
    <id>http://www.feeltens.com/macos-big-sur-upgrade/</id>
    <published>2020-11-20T11:23:44.000Z</published>
    <updated>2020-11-21T05:36:36.761Z</updated>
    
    <content type="html"><![CDATA[<p>自从 Apple 发布 macOS Big Sur 系统之后，笔者就怀着一颗追新的心，马不停蹄地下载 macOS Big Sur 完整镜像，抹盘重装自己的 Macbook。然后，Macbook 就一天一崩溃。。幸好，有问题，咱不怕。新系统升级带来的各种软件兼容性问题，总归要解决的。基本上，每天解决一个小问题，自己手上的 Macbook 也越用越顺手了。记录一下，留作备忘。</p><a id="more"></a><h2 id="V2RayX"><a href="#V2RayX" class="headerlink" title="V2RayX"></a>V2RayX</h2><p>万万没想到，最重要的上网工具 V2RayX，竟然崩溃了。没关系，我换用 ClashX 就好了。</p><h2 id="Proxifier"><a href="#Proxifier" class="headerlink" title="Proxifier"></a>Proxifier</h2><p>Proxifier 作为最常用的代理软件，在 Big Sur 系统上，需要升级到 V3 版本。但最关键的注册码，从何而来呢？幸好有万能的 GitHub，顺便贴出自己的 Proxifier for Mac V3 注册码：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">3CWNN-WYTP4-SD83W-ASDFR-84KEA</span><br></pre></td></tr></table></figure><h2 id="WeChat-plugin"><a href="#WeChat-plugin" class="headerlink" title="WeChat-plugin"></a>WeChat-plugin</h2><p>在 Mac 微信上删除对话框，然后 Macbook 又 crash 了。。没关系，我暂时不用 WeChat-plugin 的防撤回功能了。</p><h2 id="迅雷"><a href="#迅雷" class="headerlink" title="迅雷"></a>迅雷</h2><p>之前的 Thunder v6.6.6 修改版也闪退了，幸好找到了 Thunder for Mac v9.9.9 版本，虽然不完美，但凑合用吧。</p><h2 id="Turbo-Boost-Switcher-Pro"><a href="#Turbo-Boost-Switcher-Pro" class="headerlink" title="Turbo Boost Switcher Pro"></a>Turbo Boost Switcher Pro</h2><p>升级完系统，第一时间更新了 Turbo Boost Switcher Pro 新版本。但是总是禁用不了 Turbo Boost。关键时刻还得靠官网 FAQ。详见：<a href="https://www.rugarciap.com/faqs/" target="_blank" rel="noopener">https://www.rugarciap.com/faqs/</a></p><p>重要步骤：重启到 Recovery 模式（启动时，长按 Command + R），打开 Terminal，输入如下命令：（YourVolumeName 替换成你的系统盘的卷名称）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kmutil trigger-panic-medic --volume-root /Volumes/&lt;YourVolumeName&gt;</span><br></pre></td></tr></table></figure><p>然后，再重启，就发现可以禁用 Intel 的 Turbo Boost 了。</p><h2 id="Parallels-Desktop-16-联网"><a href="#Parallels-Desktop-16-联网" class="headerlink" title="Parallels Desktop 16 联网"></a>Parallels Desktop 16 联网</h2><p>在 Parallels Desktop 16 特别版上，虚拟机无法联网。</p><p>此时，完全退出 Parallels Desktop。在 Terminal 中，输入以下命令和用户密码，会自动启动 Parallels Desktop。（注意：Terminal 不要关掉。）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -b /Applications/Parallels\ Desktop.app/Contents/MacOS/prl_client_app</span><br></pre></td></tr></table></figure><p>后来，又去试了一下 VMware Fusion for Mac v12，还算不错，但首选还是 PD。</p><hr><p>总结一下，追新挺好，稳定为主。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;自从 Apple 发布 macOS Big Sur 系统之后，笔者就怀着一颗追新的心，马不停蹄地下载 macOS Big Sur 完整镜像，抹盘重装自己的 Macbook。然后，Macbook 就一天一崩溃。。幸好，有问题，咱不怕。新系统升级带来的各种软件兼容性问题，总归要解决的。基本上，每天解决一个小问题，自己手上的 Macbook 也越用越顺手了。记录一下，留作备忘。&lt;/p&gt;
    
    </summary>
    
    
      <category term="macOS" scheme="http://www.feeltens.com/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>IntelliJ IDEA 技巧</title>
    <link href="http://www.feeltens.com/idea-skills/"/>
    <id>http://www.feeltens.com/idea-skills/</id>
    <published>2020-08-08T06:45:40.000Z</published>
    <updated>2020-11-21T05:37:34.491Z</updated>
    
    <content type="html"><![CDATA[<h2 id="idea-一键展开或折叠所有文件夹"><a href="#idea-一键展开或折叠所有文件夹" class="headerlink" title="idea 一键展开或折叠所有文件夹"></a>idea 一键展开或折叠所有文件夹</h2><p>要点：先选中，再操作</p><p>一键展开所有文件夹：选中目标文件夹，按向右箭头一次，展开一级；一直按着不放，展开所有文件夹。</p><p>一键折叠所有文件夹：选中目标文件夹，按向左箭头一次，折叠一级；一直按着不放，折叠所有文件夹。</p><p>再次体会到了 idea 的智能与强大。背后都是 JetBrains 人的匠心独运与辛勤努力。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;idea-一键展开或折叠所有文件夹&quot;&gt;&lt;a href=&quot;#idea-一键展开或折叠所有文件夹&quot; class=&quot;headerlink&quot; title=&quot;idea 一键展开或折叠所有文件夹&quot;&gt;&lt;/a&gt;idea 一键展开或折叠所有文件夹&lt;/h2&gt;&lt;p&gt;要点：先选中，再操作
      
    
    </summary>
    
      <category term="skill" scheme="http://www.feeltens.com/categories/skill/"/>
    
    
      <category term="idea" scheme="http://www.feeltens.com/tags/idea/"/>
    
  </entry>
  
  <entry>
    <title>2020 只言片语</title>
    <link href="http://www.feeltens.com/2020-some-words/"/>
    <id>http://www.feeltens.com/2020-some-words/</id>
    <published>2020-03-15T11:29:48.000Z</published>
    <updated>2020-11-20T13:31:11.160Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2020-03"><a href="#2020-03" class="headerlink" title="2020-03"></a>2020-03</h2><h3 id="2020-03-15"><a href="#2020-03-15" class="headerlink" title="2020-03-15"></a>2020-03-15</h3><p>软件开发的三个关注点：时空人</p><ul><li>时间：各种状态流转、业务流、数据流</li><li>空间：与其他系统（外部系统、子系统、模块、中间件、组件）、系统内部其他实体等的关联关系</li><li>人：各种用户（使用者）的使用流程步骤、用户体验</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;2020-03&quot;&gt;&lt;a href=&quot;#2020-03&quot; class=&quot;headerlink&quot; title=&quot;2020-03&quot;&gt;&lt;/a&gt;2020-03&lt;/h2&gt;&lt;h3 id=&quot;2020-03-15&quot;&gt;&lt;a href=&quot;#2020-03-15&quot; class=&quot;head
      
    
    </summary>
    
      <category term="只言片语" scheme="http://www.feeltens.com/categories/%E5%8F%AA%E8%A8%80%E7%89%87%E8%AF%AD/"/>
    
    
  </entry>
  
  <entry>
    <title>IDEA Git 忽略文件最佳方式</title>
    <link href="http://www.feeltens.com/idea-gitignore/"/>
    <id>http://www.feeltens.com/idea-gitignore/</id>
    <published>2019-09-19T14:51:08.000Z</published>
    <updated>2020-11-20T13:31:11.162Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IDEA-Git-忽略文件最佳方式"><a href="#IDEA-Git-忽略文件最佳方式" class="headerlink" title="IDEA Git 忽略文件最佳方式"></a>IDEA Git 忽略文件最佳方式</h1><h2 id="文件没有纳入版本管理"><a href="#文件没有纳入版本管理" class="headerlink" title="文件没有纳入版本管理"></a>文件没有纳入版本管理</h2><p>加入 .gitignore 文件中。</p><p>推荐安装并使用 .gitignore 和 Add to gitignore 两个插件。</p><h2 id="文件已经纳入版本管理"><a href="#文件已经纳入版本管理" class="headerlink" title="文件已经纳入版本管理"></a>文件已经纳入版本管理</h2><p>IntelliJ IDEA 提供了 changelist 功能，可以对文件进行分类，提交时，只提交 active（活跃的）changelist。</p><a id="more"></a><p>在 IDEA 最下面的 Version Control，右键，点击「New Changelist」</p><p><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190919223824.png" alt></p><p>命名为 ignored。</p><p><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190919223947.png" alt></p><p>修改需要忽略的文件，将文件从 Default Changelist 拖动到 ignored 里面。</p><p><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190919224125.png" alt></p><p>以后 git 提交时，选择 Changelist 为 Default Changelist 即可。此时忽略的文件便不会出现在提交文件列表里了。</p><p><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190919224521.png" alt></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;IDEA-Git-忽略文件最佳方式&quot;&gt;&lt;a href=&quot;#IDEA-Git-忽略文件最佳方式&quot; class=&quot;headerlink&quot; title=&quot;IDEA Git 忽略文件最佳方式&quot;&gt;&lt;/a&gt;IDEA Git 忽略文件最佳方式&lt;/h1&gt;&lt;h2 id=&quot;文件没有纳入版本管理&quot;&gt;&lt;a href=&quot;#文件没有纳入版本管理&quot; class=&quot;headerlink&quot; title=&quot;文件没有纳入版本管理&quot;&gt;&lt;/a&gt;文件没有纳入版本管理&lt;/h2&gt;&lt;p&gt;加入 .gitignore 文件中。&lt;/p&gt;
&lt;p&gt;推荐安装并使用 .gitignore 和 Add to gitignore 两个插件。&lt;/p&gt;
&lt;h2 id=&quot;文件已经纳入版本管理&quot;&gt;&lt;a href=&quot;#文件已经纳入版本管理&quot; class=&quot;headerlink&quot; title=&quot;文件已经纳入版本管理&quot;&gt;&lt;/a&gt;文件已经纳入版本管理&lt;/h2&gt;&lt;p&gt;IntelliJ IDEA 提供了 changelist 功能，可以对文件进行分类，提交时，只提交 active（活跃的）changelist。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Git" scheme="http://www.feeltens.com/tags/Git/"/>
    
      <category term="IDEA" scheme="http://www.feeltens.com/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>2019 只言片语</title>
    <link href="http://www.feeltens.com/2019-some-words/"/>
    <id>http://www.feeltens.com/2019-some-words/</id>
    <published>2019-08-04T11:54:32.000Z</published>
    <updated>2020-11-20T13:31:11.160Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2019-08"><a href="#2019-08" class="headerlink" title="2019-08"></a>2019-08</h2><h3 id="2019-08-04"><a href="#2019-08-04" class="headerlink" title="2019-08-04"></a>2019-08-04</h3><p>不成熟的优化是万恶之源。</p><h3 id="2019-08-05"><a href="#2019-08-05" class="headerlink" title="2019-08-05"></a>2019-08-05</h3><p>软件技术，是没有银弹的。——Fred Brooks</p><h3 id="2019-10-19"><a href="#2019-10-19" class="headerlink" title="2019-10-19"></a>2019-10-19</h3><p>脏数据的产生，一定是致命的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;2019-08&quot;&gt;&lt;a href=&quot;#2019-08&quot; class=&quot;headerlink&quot; title=&quot;2019-08&quot;&gt;&lt;/a&gt;2019-08&lt;/h2&gt;&lt;h3 id=&quot;2019-08-04&quot;&gt;&lt;a href=&quot;#2019-08-04&quot; class=&quot;head
      
    
    </summary>
    
      <category term="只言片语" scheme="http://www.feeltens.com/categories/%E5%8F%AA%E8%A8%80%E7%89%87%E8%AF%AD/"/>
    
    
  </entry>
  
  <entry>
    <title>Git 忽略文件目录权限或文件拥有者的改变</title>
    <link href="http://www.feeltens.com/git-ignore-filemode/"/>
    <id>http://www.feeltens.com/git-ignore-filemode/</id>
    <published>2019-07-26T07:39:55.000Z</published>
    <updated>2020-11-20T13:31:11.162Z</updated>
    
    <content type="html"><![CDATA[<p>笔者在重装系统和使用 chmod &amp; chown 命令后，发现 IntelliJ IDEA 中的工程代码会出现大范围的代码不一致的情况（其实代码没有修改过）。后来查阅资料，发现 Git 默认会把文件权限也算作文件差异的一部分。</p><a id="more"></a><p>解决办法：</p><p>git 中可以加入忽略文件权限的配置，在 git 根目录运行如下命令：<br>当前版本库忽略文件权限<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config core.filemode false</span><br></pre></td></tr></table></figure></p><p>所有版本库忽略文件权限<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.filemode false</span><br></pre></td></tr></table></figure></p><p>这样就设置了忽略文件权限。</p><p>查看 git 的配置文件：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat .git/config</span><br></pre></td></tr></table></figure></p><p>这时候再更新代码就 OK 了。</p><p>参考资料：<br>git 中忽略文件权限或文件拥有者的改变 - 冰狼爱魔 - 博客园<br><a href="https://www.cnblogs.com/itsharehome/p/4866837.html" target="_blank" rel="noopener">https://www.cnblogs.com/itsharehome/p/4866837.html</a><br>How do I make Git ignore file mode (chmod) changes? - Stack Overflow<br><a href="https://stackoverflow.com/questions/1580596/how-do-i-make-git-ignore-file-mode-chmod-changes" target="_blank" rel="noopener">https://stackoverflow.com/questions/1580596/how-do-i-make-git-ignore-file-mode-chmod-changes</a><br>git config 官方说明<br><a href="https://mirrors.edge.kernel.org/pub/software/scm/git/docs/git-config.html#EXAMPLES" target="_blank" rel="noopener">https://mirrors.edge.kernel.org/pub/software/scm/git/docs/git-config.html#EXAMPLES</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;笔者在重装系统和使用 chmod &amp;amp; chown 命令后，发现 IntelliJ IDEA 中的工程代码会出现大范围的代码不一致的情况（其实代码没有修改过）。后来查阅资料，发现 Git 默认会把文件权限也算作文件差异的一部分。&lt;/p&gt;
    
    </summary>
    
    
      <category term="Git" scheme="http://www.feeltens.com/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title>macOS skills</title>
    <link href="http://www.feeltens.com/macos-skills/"/>
    <id>http://www.feeltens.com/macos-skills/</id>
    <published>2019-07-23T13:58:47.000Z</published>
    <updated>2020-11-20T13:31:11.164Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装任何来源软件"><a href="#安装任何来源软件" class="headerlink" title="安装任何来源软件"></a>安装任何来源软件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo spctl --master-disable</span><br></pre></td></tr></table></figure><h2 id="修改文件夹权限"><a href="#修改文件夹权限" class="headerlink" title="修改文件夹权限"></a>修改文件夹权限</h2><p>创建带权限的文件目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /opt/fastdfs</span><br></pre></td></tr></table></figure></p><p>修改文件目录的持有者（推荐使用）<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R $USER /opt/fastdfs</span><br></pre></td></tr></table></figure></p><p>修改已存在的文件目录权限<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 777 /opt/fastdfs</span><br></pre></td></tr></table></figure></p><h2 id="调整菜单栏图标位置"><a href="#调整菜单栏图标位置" class="headerlink" title="调整菜单栏图标位置"></a>调整菜单栏图标位置</h2><p>按住 <code>Command</code>，手动拖拽系统图标</p><a id="more"></a><h2 id="隐藏-Transcend-JetDrive-Lite"><a href="#隐藏-Transcend-JetDrive-Lite" class="headerlink" title="隐藏 Transcend JetDrive Lite"></a>隐藏 Transcend JetDrive Lite</h2><ol><li>为你的 Transcend 制作替身，也就是快捷方式</li><li>将该替身重命名为 <code>SD</code>，然后保存到非 Transcend 磁盘的其他地方</li><li>将快捷方式拖入 Finder 左侧个人收藏边栏</li><li>使用 File Locker 将 /Volumes/SD 隐藏。</li></ol><h2 id="切换中英文输入法"><a href="#切换中英文输入法" class="headerlink" title="切换中英文输入法"></a>切换中英文输入法</h2><p>System Perences → Keyboard → Shortcuts → Input Sources → 勾选 Select the previous input source</p><h2 id="修改配置文件，提前备份"><a href="#修改配置文件，提前备份" class="headerlink" title="修改配置文件，提前备份"></a>修改配置文件，提前备份</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp oldFile newFile</span><br></pre></td></tr></table></figure><h2 id="macOS-查看哪些端口被占用"><a href="#macOS-查看哪些端口被占用" class="headerlink" title="macOS 查看哪些端口被占用"></a>macOS 查看哪些端口被占用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo lsof -i :9000</span><br><span class="line">sudo kill -9 364</span><br></pre></td></tr></table></figure><p><code>lsof</code> 代表 <code>list open file</code>。<br><code>-i</code> 代表网络连接。<br><code>:9000</code> 指明端口号。</p><h2 id="macOS-优酷客户端下载的视频位置"><a href="#macOS-优酷客户端下载的视频位置" class="headerlink" title="macOS 优酷客户端下载的视频位置"></a>macOS 优酷客户端下载的视频位置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Containers/com.youku.mac/Data/</span><br></pre></td></tr></table></figure><h2 id="macOS-语言设置"><a href="#macOS-语言设置" class="headerlink" title="macOS 语言设置"></a>macOS 语言设置</h2><ul><li>macOS 全局语言设置</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System Preferences → Language &amp; Region → Preferred languages</span><br></pre></td></tr></table></figure><ul><li>macOS 系统初始化 Recovery 语言</li></ul><p>打开终端 Terminal 输入</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo languagesetup</span><br></pre></td></tr></table></figure><p>然后输入 1) 是英文，重启电脑</p><p>13) 是简体中文</p><ul><li>App-Language</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">App-Language-Chooser</span><br><span class="line">Language-Switcher</span><br><span class="line">LanguagesService</span><br><span class="line">LinguaSwitch</span><br></pre></td></tr></table></figure><ul><li>修改单个 Mac 应用程序的默认语言</li></ul><p>在使用英文作为 Mac 默认语言的时候，需要让 Microsoft Word 以简体中文运行。</p><ol><li><p>找到 App 的 Bundle Identifier<br> Bundle Identifier 是 App 的标识。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mdls -name kMDItemCFBundleIdentifier /Applications/Microsoft\ Word.app</span><br></pre></td></tr></table></figure><p>注意：在命令行中，如果文件名或者目录名中包含空格，是需要用『\』来转义的。</p><p>命令运行之后，会返回以下的结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kMDItemCFBundleIdentifier = "com.microsoft.Word"</span><br></pre></td></tr></table></figure><p>其中，com.microsoft.word 就是 Microsoft Word 的 Bundle Identifier 。</p><p>kMDItemCFBundleIdentifier = “com.microsoft.Word”</p></li><li><p>修改 Microsoft Word 的默认语言为简体中文</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.microsoft.Word AppleLanguages '("zh-Hans")'</span><br></pre></td></tr></table></figure><p>修改完之后，是永久生效的。可以用相同的方法，修改回原来的语言。</p><p>如果只需要让某个 App 以某种语言临时运行一次，不希望修改它的默认运行语言，可以输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Applications/iCal.app/Contents/MacOS/iCal -AppleLanguages '(de)'</span><br></pre></td></tr></table></figure><p>或使用 Alfred Workflows</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Open App in English</span><br><span class="line">Open App in Chinese</span><br></pre></td></tr></table></figure></li></ol><ul><li>VOX 播放器语言设置成中文</li></ul><p>用 Finder 打开应用程序文件夹, 找到 VOX, 右键显示文件包内容,  </p><p>依次打开 Contents-Resources, 找到最后一个 zh-Hant.lproj 文件夹,  </p><p>将里面的所有文件都复制覆盖到 en.lproj 文件夹, 然后再打开 VOX。</p><h2 id="macOS-清空字体缓存"><a href="#macOS-清空字体缓存" class="headerlink" title="macOS 清空字体缓存"></a>macOS 清空字体缓存</h2><p>只适用于 OSX 10.5 及以上版本。<br>首先退出字体册，然后退出所有可能在使用字体的应用程序（如 Word，Pages 等）；</p><p>然后在『Terminal』中输入下面的命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo atsutil databases -remove</span><br><span class="line">atsutil databases -removeUser</span><br><span class="line">atsutil server -shutdown</span><br><span class="line">atsutil server -ping</span><br></pre></td></tr></table></figure><h2 id="提取-Mac-应用程序图标"><a href="#提取-Mac-应用程序图标" class="headerlink" title="提取 Mac 应用程序图标"></a>提取 Mac 应用程序图标</h2><p>方法一：使用预览工具 Preview 快速提取 App 图标<br>方法二：直接提取 App 图标的 icns 文件。在 App 右键 → Show Package Contents → Content → Resources</p><h2 id="macOS-原生截图"><a href="#macOS-原生截图" class="headerlink" title="macOS 原生截图"></a>macOS 原生截图</h2><ul><li><p>对整个屏幕截图 → 按 Command (⌘) + Shift + 3</p></li><li><p>对某个窗口截图</p><p>按 Command + Shift + 4。指针会变为十字准线。<br>接着按空格键。指针会变为相机指针。<br>将相机指针移至某个窗口以使其高亮显示。<br>点按鼠标或触控板。要取消，请按 Escape (esc) 键，然后点按。</p></li><li><p>修改截图的默认保存路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">com.apple.screencapture location ~/Desktop/ScreenShots</span><br><span class="line">killall SystemUIServer</span><br></pre></td></tr></table></figure></li><li><p>去掉或恢复截图的阴影</p><p>去掉截图的阴影</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.screencapture disable-shadow -bool true</span><br><span class="line">killall SystemUIServer</span><br></pre></td></tr></table></figure><p>恢复截图的阴影</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.screencapture disable-shadow -bool false</span><br><span class="line">killall SystemUIServer</span><br></pre></td></tr></table></figure></li></ul><h2 id="如何让-Finder-出现退出选项"><a href="#如何让-Finder-出现退出选项" class="headerlink" title="如何让 Finder 出现退出选项"></a>如何让 Finder 出现退出选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.Finder QuitMenuItem 1</span><br></pre></td></tr></table></figure><p>重启 Finder 之后才能生效<br>恢复原来的样子</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.Finder QuitMenuItem 0</span><br></pre></td></tr></table></figure><h2 id="修改-hosts"><a href="#修改-hosts" class="headerlink" title="修改 hosts"></a>修改 hosts</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 755 /etc/hosts</span><br><span class="line">sudo vi /etc/hosts</span><br></pre></td></tr></table></figure><p>建议使用 SwitchHosts</p><h2 id="macOS-开机音效"><a href="#macOS-开机音效" class="headerlink" title="macOS 开机音效"></a>macOS 开机音效</h2><p>取消开机音效<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvram SystemAudioVolume=%80</span><br></pre></td></tr></table></figure></p><p>恢复开机音效<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nvram -d SystemAudioVolume</span><br></pre></td></tr></table></figure></p><h2 id="删除自带的输入法"><a href="#删除自带的输入法" class="headerlink" title="删除自带的输入法"></a>删除自带的输入法</h2><p>安装 PlistEdit Pro</p><p>在终端里输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo open ~/Library/Preferences/com.apple.HIToolbox.plist</span><br></pre></td></tr></table></figure><p>选中 「Root」→「AppleEnabledInputSources」</p><p>接着会跳出名为“0、1、2、3、4、5、6” 的文件夹，逐个翻阅各个文件夹。</p><p>待找到出现 KeyBoardLayout Name 为 <code>ABC</code> 关键字样的文件夹时，删除整个以数字命名的文件。保存，关闭。</p><p>重启电脑</p><h2 id="Finder-更改所有文件夹显示选项"><a href="#Finder-更改所有文件夹显示选项" class="headerlink" title="Finder 更改所有文件夹显示选项"></a>Finder 更改所有文件夹显示选项</h2><ul><li><p>打开 Finder，连续点击 Command + ↑ 数次，直到界面不再跳转即可查看到磁盘的图标；</p></li><li><p>选择显示类型</p></li><li><p>Command + J</p></li><li><p>设置显示效果</p><p>Always open in list view<br>Browse in list view<br>Text size: 14<br>Use as Defaults</p></li><li><p>打开 Terminal，输入命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find / -name .DS_Store -exec rm &#123;&#125; +</span><br></pre></td></tr></table></figure></li><li><p>重启 Finder</p></li></ul><h2 id="macOS-定时关机、重启、睡眠"><a href="#macOS-定时关机、重启、睡眠" class="headerlink" title="macOS 定时关机、重启、睡眠"></a>macOS 定时关机、重启、睡眠</h2><h3 id="定期设定"><a href="#定期设定" class="headerlink" title="定期设定"></a>定期设定</h3><p>System Preferences → Energy Saver → Schedule… → Shut Down  Every Day  at 22:00</p><h3 id="临时设定"><a href="#临时设定" class="headerlink" title="临时设定"></a>临时设定</h3><ul><li>通过终端命令配置单次任务</li></ul><p>设定 2012 年 11 月 7 日 23:15 关机</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo shutdown -h 1211072315</span><br></pre></td></tr></table></figure><p>设定 2012 年 11 月 7 日 23:15 重启</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo shutdown -r 1211072315</span><br></pre></td></tr></table></figure><p>设定 2012 年 11 月 7 日 23:15 睡眠</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo shutdown -s 1211072315</span><br></pre></td></tr></table></figure><p>命令的主体主要是 shutdown，h/r/s 分别代表关机 / 重启 / 睡眠，然后在后面加上执行时间 (yymmddhhmm) 即可。</p><ul><li>通过终端取消单次定时任务</li></ul><p>注意创建的 pid 623，这是指当前运行的这个 shutdown 命令的进程号，如果要取消关机，只需要停止这个进程的运行就可以了。命令为：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo kill 623</span><br></pre></td></tr></table></figure><h2 id="制作启动盘命令"><a href="#制作启动盘命令" class="headerlink" title="制作启动盘命令"></a>制作启动盘命令</h2><p>把 U 盘抹掉，名称设置为 ABC</p><p>Format: Mac OS Extended (Journaled)</p><p>GUID</p><p>以下命令在 Terminal 中手动输入 + Tab 提示。</p><p>macOS Mojave<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /Applications/Install\ macOS\ Mojave.app/Contents/Resources/createinstallmedia --volume /Volumes/ABC --applicationpath /Applications/Install\ macOS\ Mojave.app --nointeraction</span><br></pre></td></tr></table></figure></p><p>macOS Catalina Beta<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /Applications/Install\ macOS\ Catalina\ Beta.app/Contents/Resources/createinstallmedia --volume /Volumes/ABC</span><br></pre></td></tr></table></figure></p><h2 id="系统服务-amp-用户服务"><a href="#系统服务-amp-用户服务" class="headerlink" title="系统服务 &amp; 用户服务"></a>系统服务 &amp; 用户服务</h2><p>系统服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/System/Library/Services</span><br></pre></td></tr></table></figure><p>用户服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Services</span><br></pre></td></tr></table></figure><h2 id="QuickLook「快速预览」-插件扩展"><a href="#QuickLook「快速预览」-插件扩展" class="headerlink" title="QuickLook「快速预览」 插件扩展"></a>QuickLook「快速预览」 插件扩展</h2><p>.qlgenerator</p><p>安装步骤：</p><p>将插件移动到 /Library/QuickLook 目录下</p><p>使用「终端」重启 QuickLook</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qlmanage -r</span><br></pre></td></tr></table></figure><p>插件列表：</p><ul><li>qlmarkdown 兼容 markdown</li><li>QLColorCode 高亮查看代码</li><li>QuickLookJSON 查看 JSON 文件</li><li>QLPrettyPatch 查看 Patch 文件</li><li>QLStephen 预览无拓展名的纯文本文件</li><li>QuickLookCSV 预览 CSV 文件</li><li>BetterZipQL 查看 Zip 压缩文件的信息以及文件目录</li><li>QLlmageSize 在预览窗口的标题栏中显示图片分辨率及文件大小</li><li>WebP 快速查看 WebP 格式图片</li></ul><h2 id="QuickLook（快速查看）直接选择和复制文字"><a href="#QuickLook（快速查看）直接选择和复制文字" class="headerlink" title="QuickLook（快速查看）直接选择和复制文字"></a>QuickLook（快速查看）直接选择和复制文字</h2><p>终端开启命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder QLEnableTextSelection -bool TRUE;killall Finder</span><br></pre></td></tr></table></figure><p>恢复命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults delete com.apple.finder QLEnableTextSelection;killall Finder</span><br></pre></td></tr></table></figure><p>禁止 mac 的隐藏开机启动项</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Library/LaunchAgents</span><br></pre></td></tr></table></figure><h2 id="Mac-登陆-去掉-其他用户"><a href="#Mac-登陆-去掉-其他用户" class="headerlink" title="Mac 登陆 去掉 其他用户"></a>Mac 登陆 去掉 其他用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo defaults write /Library/Preferences/com.apple.loginwindow SHOWOTHERUSERS_MANAGED -bool FALSE</span><br></pre></td></tr></table></figure><h2 id="Mac-解压压缩乱码问题解决"><a href="#Mac-解压压缩乱码问题解决" class="headerlink" title="Mac 解压压缩乱码问题解决"></a>Mac 解压压缩乱码问题解决</h2><p>Mac 的 zip 格式压缩，使用的字符编码是当前系统默认的 UTF-8；<br>Windows 系统中文版默认字符集是 GB2312。</p><p>在 macOS 系统中，推荐使用 The Archive Browser 解压，使用 BetterZip 压缩。</p><h2 id="显示-隐藏文件命令"><a href="#显示-隐藏文件命令" class="headerlink" title="显示/隐藏文件命令"></a>显示/隐藏文件命令</h2><p>显示隐藏文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles YES</span><br><span class="line"></span><br><span class="line">defaults write com.apple.finder AppleShowAllFiles -bool true</span><br></pre></td></tr></table></figure><p>隐藏隐藏文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles NO</span><br><span class="line"></span><br><span class="line">defaults write com.apple.finder AppleShowAllFiles -bool false</span><br></pre></td></tr></table></figure><h2 id="macOS-终端走代理"><a href="#macOS-终端走代理" class="headerlink" title="macOS 终端走代理"></a>macOS 终端走代理</h2><p>启用了 shadowsocks 且本地代理为 socks5://127.0.0.1:1080</p><p>设置代理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export ALL_PROXY=socks5://127.0.0.1:1080</span><br></pre></td></tr></table></figure><p>清除代理</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unset ALL_PROXY</span><br></pre></td></tr></table></figure><p>查看 ip 测试是否生效</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -i https://ip.cn</span><br></pre></td></tr></table></figure><p>为了方便使用，可以为上述长命名设置 alias</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi ~/.zshrc</span><br></pre></td></tr></table></figure><p>添加如下配置信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alias setproxy=&quot;export ALL_PROXY=socks5://127.0.0.1:1080&quot;</span><br><span class="line">alias unsetproxy=&quot;unset ALL_PROXY&quot;</span><br><span class="line">alias ip=&quot;curl -i http://ip.cn&quot;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/.zshrc</span><br></pre></td></tr></table></figure><p>在使用终端走代理时，setproxy；</p><p>不使用终端走代理时，unsetprocy</p><h2 id="Mac-设置-Launchpad-的列数和行数"><a href="#Mac-设置-Launchpad-的列数和行数" class="headerlink" title="Mac 设置 Launchpad 的列数和行数"></a>Mac 设置 Launchpad 的列数和行数</h2><p>设置 Launchpad 的列数，对应于每一行 App 的个数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.dock springboard-columns -int 列数</span><br></pre></td></tr></table></figure><p>设置 Launchpad 的行数，对应于每一列 App 的个数</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.dock springboard-rows -int 行数</span><br></pre></td></tr></table></figure><p>重置 Launchpad</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.dock ResetLaunchPad -bool TRUE</span><br></pre></td></tr></table></figure><p>重置 Dock</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall Dock</span><br></pre></td></tr></table></figure><h2 id="Mac-一次性打开多个特定网页"><a href="#Mac-一次性打开多个特定网页" class="headerlink" title="Mac 一次性打开多个特定网页"></a>Mac 一次性打开多个特定网页</h2><p>打开 Automator → Application → Library → Internet → Get Specified URLs → 添加特定网页地址 → Display Webpages → Command + S → 保存为 Application</p><h2 id="Mac-系统预置-app-路径"><a href="#Mac-系统预置-app-路径" class="headerlink" title="Mac 系统预置 app 路径"></a>Mac 系统预置 app 路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/System/Library/CoreServices/</span><br></pre></td></tr></table></figure><p>比如 /System/Library/CoreServices/Finder.app</p><h2 id="Mac-输入法路径"><a href="#Mac-输入法路径" class="headerlink" title="Mac 输入法路径"></a>Mac 输入法路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Library/Input Methods/Qingg.app</span><br></pre></td></tr></table></figure><h2 id="Mac-终端切换到-root-用户"><a href="#Mac-终端切换到-root-用户" class="headerlink" title="Mac 终端切换到 root 用户"></a>Mac 终端切换到 root 用户</h2><p>终端命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br></pre></td></tr></table></figure><p>输入 root 用户密码</p><h2 id="Mac-Ubuntu-Linux-配置-sudo-免密码"><a href="#Mac-Ubuntu-Linux-配置-sudo-免密码" class="headerlink" title="Mac / Ubuntu / Linux 配置 sudo 免密码"></a>Mac / Ubuntu / Linux 配置 sudo 免密码</h2><p>终端命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -i</span><br></pre></td></tr></table></figure></p><p>输入 root 用户密码</p><p>修改文件权限，可读写<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+w /etc/sudoers</span><br></pre></td></tr></table></figure></p><p>配置修改账户免密</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/sudoers</span><br></pre></td></tr></table></figure><p>输入命令 <code>/wheel</code> 找到</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># root and users in group wheel can run anything on any machine as any user</span><br><span class="line">root        ALL = (ALL) ALL</span><br><span class="line">%admin      ALL = (ALL) ALL</span><br></pre></td></tr></table></figure><p>修改为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># root and users in group wheel can run anything on any machine as any user</span><br><span class="line">#root       ALL = (ALL) ALL</span><br><span class="line">#%admin     ALL = (ALL) ALL</span><br><span class="line">root            ALL = (ALL) NOPASSWD: NOPASSWD: ALL</span><br><span class="line">%admin          ALL = (ALL) NOPASSWD: NOPASSWD: ALL</span><br></pre></td></tr></table></figure><h2 id="禁止-DS-store-生成"><a href="#禁止-DS-store-生成" class="headerlink" title="禁止 .DS_store 生成"></a>禁止 .DS_store 生成</h2><p>禁止 .DS_store 生成，打开“终端”，复制黏贴下面的命令，回车执行，重启 Mac 即可生效。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool TRUE</span><br></pre></td></tr></table></figure></p><p>恢复 .DS_store 生成<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults delete com.apple.desktopservices DSDontWriteNetworkStores</span><br></pre></td></tr></table></figure></p><p>刪除已存在的.DS_Store<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo find . -name ".DS_Store" -depth -exec rm &#123;&#125; \;</span><br></pre></td></tr></table></figure></p><h2 id="macOS-Command-Q-防止-App-误按退出"><a href="#macOS-Command-Q-防止-App-误按退出" class="headerlink" title="macOS Command + Q 防止 App 误按退出"></a>macOS Command + Q 防止 App 误按退出</h2><ul><li><p>SlowQuitApps 延缓关闭操作</p></li><li><p>CommandQ</p></li><li><p>QBlocker</p></li><li><p>Karabiner</p><p>  Press Command+Q twice to Quit Application</p><p>  <a href="https://pqrs.org/osx/karabiner/complex_modifications/" target="_blank" rel="noopener">https://pqrs.org/osx/karabiner/complex_modifications/</a></p><p>  搜索 command+q</p></li><li><p>Hammerspoon</p><p>  安装 double_cmdq_to_quit.lua</p></li></ul><h2 id="分区格式-APFS-降级为-HFS"><a href="#分区格式-APFS-降级为-HFS" class="headerlink" title="分区格式 APFS 降级为 HFS+"></a>分区格式 APFS 降级为 HFS+</h2><ol><li>使用 U 盘启动，在终端中执行命令 <code>diskutil zeroDisk</code>，将分区表抹掉；</li><li>再从 U 盘重启进去再重新格式化，然后安装旧系统</li></ol><h2 id="清歌输入法-备份"><a href="#清歌输入法-备份" class="headerlink" title="清歌输入法 备份"></a>清歌输入法 备份</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~/Library/Application Support/Qingg</span><br></pre></td></tr></table></figure><h2 id="zsh-运行命令慢"><a href="#zsh-运行命令慢" class="headerlink" title="zsh 运行命令慢"></a>zsh 运行命令慢</h2><p>日志文件路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/private/var/log/asl/*.asl</span><br></pre></td></tr></table></figure></p><p>清理日志文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo du -sh /private/var/log/asl/</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /private/var/log/asl/*.asl</span><br></pre></td></tr></table></figure><h2 id="Mac-一键退出所有-App"><a href="#Mac-一键退出所有-App" class="headerlink" title="Mac 一键退出所有 App"></a>Mac 一键退出所有 App</h2><ul><li>打开 Automator，创建 Application</li><li>点击左侧 Library → Utilities，搜索 quit，选择 Quit All Applications</li><li>在右侧添加不需要退出的 App，即白名单</li><li>Command + S，保存在 /Applications，命名为「Quit All Apps」</li></ul><p>无需退出的 App 白名单</p><ul><li>Application<ul><li>Alfred</li><li>AppPolice</li><li>aText</li><li>Command-Tab Plus</li><li>Default Folder X</li><li>Flux</li><li>ForkLift</li><li>GhostSKB</li><li>Hammerspoon</li><li>iTerm</li><li>Karabiner-Elements</li><li>PopClip</li><li>ShadowsocksX-NG</li><li>SizeUp</li><li>Smooze</li><li>Snap</li><li>Snipaste</li><li>stretchly</li><li>TotalFinder</li><li>XtraFinder</li></ul></li><li>Setapp<ul><li>Bartender</li><li>BetterTouchTool</li><li>Boom 3D</li><li>Paste</li><li>ToothFairy</li></ul></li><li>Utilities<ul><li>NoSleep</li></ul></li></ul><h2 id="软链接快速访问目录"><a href="#软链接快速访问目录" class="headerlink" title="软链接快速访问目录"></a>软链接快速访问目录</h2><p>做一个软链接指向某个目录：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/run</span><br><span class="line">ln -s apache-tomcat-8.5.23 tomcat</span><br></pre></td></tr></table></figure></p><p>这样就能轻易用  <code>~/run/tomcat</code> 去访问 apache-tomcat-8.5.23 了。</p><h2 id="重置-SMC"><a href="#重置-SMC" class="headerlink" title="重置 SMC"></a>重置 SMC</h2><p>先关机，然后断开电源，拔掉所有 USB 的连接，然后同时按住键盘左下角的 Shift，Control，Option 和开机键 15 秒。全过程 Mac 不会开机。15 秒后松手插上电源开机。<br>如何重置 Mac 上的系统管理控制器 (SMC)<br><a href="https://support.apple.com/zh-cn/HT201295" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT201295</a></p><h2 id="重置-NVRAM"><a href="#重置-NVRAM" class="headerlink" title="重置 NVRAM"></a>重置 NVRAM</h2><p>将 Mac 关机，然后开机并立即同时按住以下四个按键：Option、Command、P 和 R。您可以在大约 20 秒后松开这些按键，在此期间您的 Mac 可能看似在重新启动。<br>重置 Mac 上的 NVRAM 或 PRAM<br><a href="https://support.apple.com/zh-cn/HT204063" target="_blank" rel="noopener">https://support.apple.com/zh-cn/HT204063</a></p><h2 id="macOS-启动项"><a href="#macOS-启动项" class="headerlink" title="macOS 启动项"></a>macOS 启动项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/System/Library/StartupItems</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Users/admin/Library/LaunchAgents</span><br></pre></td></tr></table></figure><h2 id="Dock-不活动的图标进入半透明状态"><a href="#Dock-不活动的图标进入半透明状态" class="headerlink" title="Dock 不活动的图标进入半透明状态"></a>Dock 不活动的图标进入半透明状态</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.dock showhidden -bool TRUE; killall Dock</span><br></pre></td></tr></table></figure><h2 id="Terminal-iTerm2-Session-Ended-进程已完成"><a href="#Terminal-iTerm2-Session-Ended-进程已完成" class="headerlink" title="Terminal / iTerm2 Session Ended 进程已完成"></a>Terminal / iTerm2 Session Ended 进程已完成</h2><h3 id="Terminal"><a href="#Terminal" class="headerlink" title="Terminal"></a>Terminal</h3><p>进入系统 <code>Terminal</code> 的偏好设置，在<code>通用</code>标签栏中，勾选<code>命令（完整的路径）</code>（默认是勾选的默认登录shell），即<code>终端</code>-&gt;<code>偏好设置</code>-&gt;<code>通用</code>-&gt;<code>shell 的打开方式</code>，选择命令（完整路径)，填写 <code>/bin/bash</code> 或 <code>/bin/zsh</code><br>然后重启 Terminal。</p><p>切换 shell 为 zsh<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure></p><h3 id="iTerm"><a href="#iTerm" class="headerlink" title="iTerm"></a>iTerm</h3><p>在 iTerm Preferences，Profiles -&gt; General -&gt; Command，选择 Command 设置 <code>/bin/zsh</code> 或者 <code>/bin/bash</code>。</p><h2 id="sudo-usr-bin-sudo-must-be-owned-by-uid-0-and-have-the-setuid-bit-set"><a href="#sudo-usr-bin-sudo-must-be-owned-by-uid-0-and-have-the-setuid-bit-set" class="headerlink" title="sudo: /usr/bin/sudo must be owned by uid 0 and have the setuid bit set"></a>sudo: /usr/bin/sudo must be owned by uid 0 and have the setuid bit set</h2><p>Log out as the current user, then log back in as root.<br>Execute<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown root:sys /usr/bin/sudo &amp;&amp; chmod 4755 /usr/bin/sudo</span><br></pre></td></tr></table></figure></p><p>Log out as root, then log back in as the current user.</p><h2 id="Mac-终端提示-login：Could-not-determine-audit-condition-Process-completed"><a href="#Mac-终端提示-login：Could-not-determine-audit-condition-Process-completed" class="headerlink" title="Mac 终端提示 login：Could not determine audit condition [Process completed]"></a>Mac 终端提示 login：Could not determine audit condition [Process completed]</h2><p>解决方案：<br>打开 Finder 前往文件夹 <code>/usr/bin/</code> 文件夹，删除 login 文件。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/bin/</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf login</span><br></pre></td></tr></table></figure><h2 id="App-Store-无法更新的问题"><a href="#App-Store-无法更新的问题" class="headerlink" title="App Store 无法更新的问题"></a>App Store 无法更新的问题</h2><p>可以修改 dns 为 1.1.1.1 加翻墙解决</p><h2 id="Mac-防止误触电源键，而关闭显示器"><a href="#Mac-防止误触电源键，而关闭显示器" class="headerlink" title="Mac 防止误触电源键，而关闭显示器"></a>Mac 防止误触电源键，而关闭显示器</h2><p>在终端输入命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.loginwindow PowerButtonSleepsSystem -bool no</span><br></pre></td></tr></table></figure></p><p>现在如果点按电源按钮是没有任何反应的，只有长按才会出现。</p><p>如果想恢复原来的设置 no 改成 yes 就可以了。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">defaults write com.apple.loginwindow PowerButtonSleepsSystem -bool yes</span><br></pre></td></tr></table></figure></p><h2 id="Mac-重置网络配置"><a href="#Mac-重置网络配置" class="headerlink" title="Mac 重置网络配置"></a>Mac 重置网络配置</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /Library/Preferences/SystemConfiguration/</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mv preferences.plist preferences.plist.bak</span><br></pre></td></tr></table></figure><p>然后重启。</p><p>此方法是备份原来的配置项，系统检测不到原来的配置项，就会自动新建。</p><h2 id="查看-macOS-应用是不是-64-位"><a href="#查看-macOS-应用是不是-64-位" class="headerlink" title="查看 macOS 应用是不是 64 位"></a>查看 macOS 应用是不是 64 位</h2><p>按住 Option 键，点击左上角的 苹果图标，选择 System Information…<br>依次点击 Software → Applications；<br>查看 64-Bit</p><h2 id="Alfred-快捷切换-MacBook-外接显示器横竖屏"><a href="#Alfred-快捷切换-MacBook-外接显示器横竖屏" class="headerlink" title="Alfred 快捷切换 MacBook 外接显示器横竖屏"></a>Alfred 快捷切换 MacBook 外接显示器横竖屏</h2><p><a href="https://www.jianshu.com/p/16120eb43728" target="_blank" rel="noopener">https://www.jianshu.com/p/16120eb43728</a></p><h2 id="苹果电脑没声音"><a href="#苹果电脑没声音" class="headerlink" title="苹果电脑没声音"></a>苹果电脑没声音</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo killall coreaudiod</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;安装任何来源软件&quot;&gt;&lt;a href=&quot;#安装任何来源软件&quot; class=&quot;headerlink&quot; title=&quot;安装任何来源软件&quot;&gt;&lt;/a&gt;安装任何来源软件&lt;/h2&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo spctl --master-disable&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;修改文件夹权限&quot;&gt;&lt;a href=&quot;#修改文件夹权限&quot; class=&quot;headerlink&quot; title=&quot;修改文件夹权限&quot;&gt;&lt;/a&gt;修改文件夹权限&lt;/h2&gt;&lt;p&gt;创建带权限的文件目录&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo mkdir -pm 775 /opt/fastdfs&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;修改文件目录的持有者（推荐使用）&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo chown -R $USER /opt/fastdfs&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;修改已存在的文件目录权限&lt;br&gt;&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo chmod -R 777 /opt/fastdfs&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;调整菜单栏图标位置&quot;&gt;&lt;a href=&quot;#调整菜单栏图标位置&quot; class=&quot;headerlink&quot; title=&quot;调整菜单栏图标位置&quot;&gt;&lt;/a&gt;调整菜单栏图标位置&lt;/h2&gt;&lt;p&gt;按住 &lt;code&gt;Command&lt;/code&gt;，手动拖拽系统图标&lt;/p&gt;
    
    </summary>
    
      <category term="skill" scheme="http://www.feeltens.com/categories/skill/"/>
    
    
      <category term="macOS" scheme="http://www.feeltens.com/tags/macOS/"/>
    
  </entry>
  
  <entry>
    <title>Linux /  macOS 修改文件目录权限</title>
    <link href="http://www.feeltens.com/linux-macos-change-file-permission/"/>
    <id>http://www.feeltens.com/linux-macos-change-file-permission/</id>
    <published>2019-07-18T21:25:13.000Z</published>
    <updated>2020-11-20T13:31:11.163Z</updated>
    
    <content type="html"><![CDATA[<p>笔者在使用 Linux 和 macOS 时，经常遇到文件目录权限不足的问题，所以整理了一些修改文件目录权限的命令。</p><a id="more"></a><h2 id="创建自带特定权限的文件目录"><a href="#创建自带特定权限的文件目录" class="headerlink" title="创建自带特定权限的文件目录"></a>创建自带特定权限的文件目录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /opt/fastdfs</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>示例命令，是创建一个权限为 775 的 <code>/opt/fastdfs</code> 的目录。</li><li><code>-p</code> 是 <code>--parents</code> 的意思，若父目录不存在，则自动创建父目录。</li><li><code>-m</code> 是 <code>--mode</code> 的意思，用于设定权限，<code>-m 775</code> 代表权限为 775。</li></ul><h2 id="修改文件目录的持有者（推荐使用）"><a href="#修改文件目录的持有者（推荐使用）" class="headerlink" title="修改文件目录的持有者（推荐使用）"></a>修改文件目录的持有者（推荐使用）</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R $USER /opt/fastdfs</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>示例命令，是将 <code>/opt/fastdfs</code> 目录的持有者修改为当前登录用户。</li><li><code>-R</code> 代表递归操作。</li><li><code>$USER</code> 代表当前登录用户，也可以修改为特定用户名。</li></ul><h2 id="修改已存在的文件目录权限"><a href="#修改已存在的文件目录权限" class="headerlink" title="修改已存在的文件目录权限"></a>修改已存在的文件目录权限</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 775 /opt/fastdfs</span><br></pre></td></tr></table></figure><p>命令说明：</p><ul><li>示例命令，是将 <code>/opt/fastdfs</code> 目录的权限修改为 775。</li></ul><hr><p>最后一句，涉及权限，谨慎使用。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;笔者在使用 Linux 和 macOS 时，经常遇到文件目录权限不足的问题，所以整理了一些修改文件目录权限的命令。&lt;/p&gt;
    
    </summary>
    
      <category term="Dev" scheme="http://www.feeltens.com/categories/Dev/"/>
    
    
      <category term="Linux" scheme="http://www.feeltens.com/tags/Linux/"/>
    
      <category term="macOS" scheme="http://www.feeltens.com/tags/macOS/"/>
    
      <category term="Shell" scheme="http://www.feeltens.com/tags/Shell/"/>
    
  </entry>
  
  <entry>
    <title>CentOS 安装部署单机版 FastDFS</title>
    <link href="http://www.feeltens.com/centos-install-fastdfs/"/>
    <id>http://www.feeltens.com/centos-install-fastdfs/</id>
    <published>2019-07-18T01:56:47.000Z</published>
    <updated>2020-11-20T13:31:11.161Z</updated>
    
    <content type="html"><![CDATA[<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>虚拟机 CentOS-7 ip：111.111.111.11<br>本地 macOS</p><p>修改 CentOS hosts<br>配置 hosts，将文件服务器的 ip 与域名映射。后期配置可以直接使用 <code>file.feeltens.com</code> 去配置服务器地址。<br>ip 变了，就只需要修改 hosts 即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br></pre></td></tr></table></figure><p>添加如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># FastDfs</span><br><span class="line">111.111.111.11 file.feeltens.com</span><br></pre></td></tr></table></figure></p><p>本地 macOS 访问虚拟机里面的 FastDFS，也需要修改 hosts。</p><a id="more"></a><p>CentOS 创建临时目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /myfolder</span><br></pre></td></tr></table></figure></p><p>安装 CentOS 依赖包：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y gcc gcc-c++ pcre pcre-devel zlib zlib-devel openssl openssl-devel</span><br></pre></td></tr></table></figure></p><h2 id="安装-FastDFS"><a href="#安装-FastDFS" class="headerlink" title="安装 FastDFS"></a>安装 FastDFS</h2><h3 id="下载安装-libfastcommon"><a href="#下载安装-libfastcommon" class="headerlink" title="下载安装 libfastcommon"></a>下载安装 libfastcommon</h3><p>libfastcommon 是从 FastDFS 和 FastDHT 中提取出来的公共 C 函数库，基础环境，安装即可 。<br><a href="https://github.com/happyfish100/libfastcommon" target="_blank" rel="noopener">https://github.com/happyfish100/libfastcommon</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/happyfish100/libfastcommon.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd libfastcommon</span><br></pre></td></tr></table></figure><p>编译、安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh &amp;&amp; ./make.sh install</span><br></pre></td></tr></table></figure></p><p>libfastcommon.so 安装到了 /usr/lib64/libfastcommon.so，但是 FastDFS 主程序设置的 lib 目录是 /usr/local/lib，所以需要创建软链接。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so</span><br><span class="line">ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so</span><br><span class="line">ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so</span><br><span class="line">ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so</span><br></pre></td></tr></table></figure></p><h3 id="下载安装-FastDFS"><a href="#下载安装-FastDFS" class="headerlink" title="下载安装 FastDFS"></a>下载安装 FastDFS</h3><p>下载 FastDFS<br><a href="https://github.com/happyfish100/fastdfs" target="_blank" rel="noopener">https://github.com/happyfish100/fastdfs</a><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/happyfish100/fastdfs.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fastdfs</span><br></pre></td></tr></table></figure><p>编译<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh</span><br></pre></td></tr></table></figure></p><p>安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./make.sh install</span><br></pre></td></tr></table></figure></p><p>默认安装方式安装后的服务脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/fdfs_trackerd</span><br><span class="line">/etc/init.d/fdfs_storaged</span><br></pre></td></tr></table></figure></p><p>默认安装方式安装后的配置文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/etc/fdfs/tracker.conf.sample</span><br><span class="line">/etc/fdfs/storage.conf.sample</span><br><span class="line">/etc/fdfs/client.conf.sample</span><br></pre></td></tr></table></figure></p><p>默认安装方式安装后的命令工具在 <code>/usr/bin</code> 目录下，列表如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/fdfs_appender_test</span><br><span class="line">/usr/bin/fdfs_appender_test1</span><br><span class="line">/usr/bin/fdfs_append_file</span><br><span class="line">/usr/bin/fdfs_crc32</span><br><span class="line">/usr/bin/fdfs_delete_file</span><br><span class="line">/usr/bin/fdfs_download_file</span><br><span class="line">/usr/bin/fdfs_file_info</span><br><span class="line">/usr/bin/fdfs_monitor</span><br><span class="line">/usr/bin/fdfs_storaged</span><br><span class="line">/usr/bin/fdfs_test</span><br><span class="line">/usr/bin/fdfs_test1</span><br><span class="line">/usr/bin/fdfs_trackerd</span><br><span class="line">/usr/bin/fdfs_upload_appender</span><br><span class="line">/usr/bin/fdfs_upload_file</span><br><span class="line">/usr/bin/stop.sh</span><br><span class="line">/usr/bin/restart.sh</span><br></pre></td></tr></table></figure></p><p>FastDFS 服务脚本设置的 bin 目录是 /usr/local/bin，但实际命令安装在 /usr/bin/ 下。<br>所以需要建立 /usr/bin 到 /usr/local/bin 的软链接。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/bin/fdfs_trackerd   /usr/local/bin</span><br><span class="line">ln -s /usr/bin/fdfs_storaged   /usr/local/bin</span><br><span class="line">ln -s /usr/bin/stop.sh         /usr/local/bin</span><br><span class="line">ln -s /usr/bin/restart.sh      /usr/local/bin</span><br></pre></td></tr></table></figure></p><h3 id="配置-FastDFS-跟踪器-Tracker"><a href="#配置-FastDFS-跟踪器-Tracker" class="headerlink" title="配置 FastDFS 跟踪器 (Tracker)"></a>配置 FastDFS 跟踪器 (Tracker)</h3><p>进入 /etc/fdfs，复制 FastDFS 跟踪器样例配置文件 tracker.conf.sample，并重命名为 tracker.conf。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp tracker.conf.sample tracker.conf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim tracker.conf</span><br></pre></td></tr></table></figure><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 配置文件是否不生效，false 为生效</span><br><span class="line">disabled=false</span><br><span class="line"></span><br><span class="line"># 提供服务的端口</span><br><span class="line">port=22122</span><br><span class="line"></span><br><span class="line"># Tracker 数据和日志目录地址（根目录必须存在，子目录会自动创建）</span><br><span class="line">base_path=/opt/fastdfs/tracker</span><br><span class="line"></span><br><span class="line"># HTTP 服务端口</span><br><span class="line">http.server_port=80</span><br></pre></td></tr></table></figure></p><p>创建 tracker 基础数据目录，即 base_path 对应的目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 777 /opt/fastdfs/tracker</span><br></pre></td></tr></table></figure></p><p>在防火墙中开放 22122 端口，本次虚拟机 CentOS 防火墙已完全关闭。</p><p>启动 Tracker<br>初次成功启动，会在 <code>/opt/fastdfs/tracker/</code> (配置的 base_path) 下创建 <code>data</code> 和 <code>logs</code> 两个目录。<br>可以用这种方式启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/fdfs_trackerd start</span><br></pre></td></tr></table></figure></p><p>也可以用这种方式启动，前提是上面创建了软链接，后面都用这种方式<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd start</span><br></pre></td></tr></table></figure></p><p>查看 FastDFS Tracker 是否已成功启动 ，22122 端口正在被监听，则算是 Tracker 服务安装成功。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -unltp | grep fdfs</span><br></pre></td></tr></table></figure></p><p>关闭 Tracker 命令：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd stop</span><br></pre></td></tr></table></figure></p><p>设置 Tracker 开机启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig fdfs_trackerd on</span><br></pre></td></tr></table></figure></p><p>或者：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure></p><p>加入配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/fdfs_trackerd start</span><br></pre></td></tr></table></figure></p><p>Tracker 服务启动成功后，会在 base_path 下创建 data、logs 两个目录。目录结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$&#123;base_path&#125;</span><br><span class="line">  |__data</span><br><span class="line">  |   |__storage_groups.dat：存储分组信息</span><br><span class="line">  |   |__storage_servers.dat：存储服务器列表</span><br><span class="line">  |__logs</span><br><span class="line">  |   |__trackerd.log： tracker server 日志文件</span><br></pre></td></tr></table></figure></p><h3 id="配置-FastDFS-存储-Storage"><a href="#配置-FastDFS-存储-Storage" class="headerlink" title="配置 FastDFS 存储 (Storage)"></a>配置 FastDFS 存储 (Storage)</h3><p>进入 /etc/fdfs 目录，复制 FastDFS 存储器样例配置文件 storage.conf.sample，并重命名为 storage.conf<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp storage.conf.sample storage.conf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim storage.conf</span><br></pre></td></tr></table></figure><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># 配置文件是否不生效，false 为生效</span><br><span class="line">disabled=false</span><br><span class="line"></span><br><span class="line"># 指定此 storage server 所在 组(卷)</span><br><span class="line">group_name=group1</span><br><span class="line"></span><br><span class="line"># storage server 服务端口</span><br><span class="line">port=23000</span><br><span class="line"></span><br><span class="line"># 心跳间隔时间，单位为秒 (这里是指主动向 tracker server 发送心跳)</span><br><span class="line">heart_beat_interval=30</span><br><span class="line"></span><br><span class="line"># Storage 数据和日志目录地址(根目录必须存在，子目录会自动生成)</span><br><span class="line">base_path=/opt/fastdfs/storage</span><br><span class="line"></span><br><span class="line"># 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录。</span><br><span class="line">store_path_count=1</span><br><span class="line"></span><br><span class="line"># 逐一配置 store_path_count 个路径，索引号基于 0。</span><br><span class="line"># 如果不配置 store_path0，那它就和 base_path 对应的路径一样。</span><br><span class="line">store_path0=/opt/fastdfs/file</span><br><span class="line"></span><br><span class="line"># FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。</span><br><span class="line"># 如果本参数只为 N（如： 256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N * N 个存放文件的子目录。</span><br><span class="line">subdir_count_per_path=256</span><br><span class="line"></span><br><span class="line"># tracker_server 的列表 ，会主动连接 tracker_server</span><br><span class="line"># 有多个 tracker server 时，每个 tracker server 写一行</span><br><span class="line">tracker_server=file.feeltens.com:22122</span><br><span class="line"></span><br><span class="line"># 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定。</span><br><span class="line">sync_start_time=00:00</span><br><span class="line">sync_end_time=23:59</span><br><span class="line"># 访问端口</span><br><span class="line">http.server_port=80</span><br></pre></td></tr></table></figure></p><p>创建 Storage 基础数据目录，对应 base_path 目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /opt/fastdfs/storage</span><br></pre></td></tr></table></figure></p><p>创建配置的 store_path0 路径<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /opt/fastdfs/file</span><br></pre></td></tr></table></figure></p><p>在防火墙中开放 23000 端口，本次虚拟机 CentOS 防火墙已完全关闭。</p><p>启动 Storage<br>启动 Storage 前确保 Tracker 是启动的。<br>初次启动成功，会在 <code>/opt/fastdfs/storage</code> 目录下创建 data、 logs 两个目录。</p><p>可以用这种方式启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/fdfs_storaged start</span><br></pre></td></tr></table></figure></p><p>也可以用这种方式，后面都用这种<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_storaged start</span><br></pre></td></tr></table></figure></p><p>查看 Storage 是否成功启动，23000 端口正在被监听，就算 Storage 启动成功。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -unltp | grep fdfs</span><br></pre></td></tr></table></figure></p><p>关闭 Storage 命令：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_storaged stop</span><br></pre></td></tr></table></figure></p><p>查看 Storage 和 Tracker 是否在通信：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/fdfs_monitor /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">➜  storage /usr/bin/fdfs_monitor /etc/fdfs/storage.conf</span><br><span class="line">[2019-06-14 06:35:39] DEBUG - base_path=/opt/fastdfs/storage, connect_timeout=30, network_timeout=60, tracker_server_count=1, anti_steal_token=0, anti_steal_secret_key length=0, use_connection_pool=0, g_connection_pool_max_idle_time=3600s, use_storage_id=0, storage server id count: 0</span><br><span class="line"></span><br><span class="line">server_count=1, server_index=0</span><br><span class="line"></span><br><span class="line">tracker server is 111.111.111.11:22122</span><br><span class="line"></span><br><span class="line">group count: 1</span><br><span class="line"></span><br><span class="line">Group 1:</span><br><span class="line">group name = group1</span><br><span class="line">disk total space = 17394 MB</span><br><span class="line">disk free space = 13128 MB</span><br><span class="line">trunk free space = 0 MB</span><br><span class="line">storage server count = 1</span><br><span class="line">active server count = 1</span><br><span class="line">storage server port = 23000</span><br><span class="line">storage HTTP port = 80</span><br><span class="line">store path count = 1</span><br><span class="line">subdir count per path = 256</span><br><span class="line">current write server index = 0</span><br><span class="line">current trunk file id = 0</span><br><span class="line"></span><br><span class="line">        Storage 1:</span><br><span class="line">                id = 111.111.111.11</span><br><span class="line">                ip_addr = 111.111.111.11 (file.feeltens.com)  ACTIVE</span><br><span class="line">                http domain = </span><br><span class="line">                version = 5.05</span><br><span class="line">                join time = 2019-06-14 06:34:57</span><br><span class="line">                up time = 2019-06-14 06:34:57</span><br><span class="line">                total storage = 17394 MB</span><br><span class="line">                free storage = 13128 MB</span><br><span class="line">                upload priority = 10</span><br><span class="line">                store_path_count = 1</span><br><span class="line">                subdir_count_per_path = 256</span><br><span class="line">                storage_port = 23000</span><br><span class="line">                storage_http_port = 80</span><br><span class="line">                current_write_path = 0</span><br><span class="line">                source storage id = </span><br><span class="line">                if_trunk_server = 0</span><br><span class="line">                connection.alloc_count = 256</span><br><span class="line">                connection.current_count = 0</span><br><span class="line">                connection.max_count = 0</span><br><span class="line">                total_upload_count = 0</span><br><span class="line">                success_upload_count = 0</span><br><span class="line">                total_append_count = 0</span><br><span class="line">                success_append_count = 0</span><br><span class="line">                total_modify_count = 0</span><br><span class="line">                success_modify_count = 0</span><br><span class="line">                total_truncate_count = 0</span><br><span class="line">                success_truncate_count = 0</span><br><span class="line">                total_set_meta_count = 0</span><br><span class="line">                success_set_meta_count = 0</span><br><span class="line">                total_delete_count = 0</span><br><span class="line">                success_delete_count = 0</span><br><span class="line">                total_download_count = 0</span><br><span class="line">                success_download_count = 0</span><br><span class="line">                total_get_meta_count = 0</span><br><span class="line">                success_get_meta_count = 0</span><br><span class="line">                total_create_link_count = 0</span><br><span class="line">                success_create_link_count = 0</span><br><span class="line">                total_delete_link_count = 0</span><br><span class="line">                success_delete_link_count = 0</span><br><span class="line">                total_upload_bytes = 0</span><br><span class="line">                success_upload_bytes = 0</span><br><span class="line">                total_append_bytes = 0</span><br><span class="line">                success_append_bytes = 0</span><br><span class="line">                total_modify_bytes = 0</span><br><span class="line">                success_modify_bytes = 0</span><br><span class="line">                stotal_download_bytes = 0</span><br><span class="line">                success_download_bytes = 0</span><br><span class="line">                total_sync_in_bytes = 0</span><br><span class="line">                success_sync_in_bytes = 0</span><br><span class="line">                total_sync_out_bytes = 0</span><br><span class="line">                success_sync_out_bytes = 0</span><br><span class="line">                total_file_open_count = 0</span><br><span class="line">                success_file_open_count = 0</span><br><span class="line">                total_file_read_count = 0</span><br><span class="line">                success_file_read_count = 0</span><br><span class="line">                total_file_write_count = 0</span><br><span class="line">                success_file_write_count = 0</span><br><span class="line">                last_heart_beat_time = 2019-06-14 06:35:29</span><br><span class="line">                last_source_update = 1970-01-01 08:00:00</span><br><span class="line">                last_sync_update = 1970-01-01 08:00:00</span><br><span class="line">                last_synced_timestamp = 1970-01-01 08:00:00</span><br></pre></td></tr></table></figure></p><p>重要信息是 <code>Storage ip_addr = 111.111.111.11 (file.feeltens.com)  ACTIVE</code>。</p><p>设置 Storage 开机启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig fdfs_storaged on</span><br></pre></td></tr></table></figure></p><p>或者：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.d/rc.local</span><br></pre></td></tr></table></figure></p><p>加入配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/fdfs_storaged start</span><br></pre></td></tr></table></figure></p><p>Storage 目录同 Tracker，Storage 启动成功后，在 base_path 下创建了 data、logs 目录，记录着 Storage Server 的信息。<br>在 store_path0 目录下，创建了 N*N 个子目录。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/fastdfs/file/data</span><br></pre></td></tr></table></figure></p><h3 id="文件上传测试"><a href="#文件上传测试" class="headerlink" title="文件上传测试"></a>文件上传测试</h3><p>修改 Tracker 服务器中的客户端配置文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdfs</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp client.conf.sample client.conf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim client.conf</span><br></pre></td></tr></table></figure><p>修改如下配置即可，其它默认。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Client 的数据和日志目录</span><br><span class="line">base_path=/opt/fastdfs/client</span><br><span class="line"></span><br><span class="line"># Tracker 端口</span><br><span class="line">tracker_server=file.feeltens.com:22122</span><br></pre></td></tr></table></figure></p><p>上传测试<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /opt/fastdfs/client</span><br></pre></td></tr></table></figure></p><p>在 CentOS 内部执行如下命令，上传 1.jpg 图片<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/fdfs_upload_file /etc/fdfs/client.conf /myfolder/1.jpg</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  /myfolder /usr/bin/fdfs_upload_file /etc/fdfs/client.conf /myfolder/1.jpg</span><br><span class="line">group1/M00/00/00/b29vC10C0YaAXl0GAADglZ7FErM123.jpg</span><br></pre></td></tr></table></figure></p><p>返回的文件 ID 由 group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。<br><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190613232013.png" alt></p><p>查找上传的图片<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/fastdfs/file/data/00/00</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll</span><br></pre></td></tr></table></figure><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  00 ll</span><br><span class="line">total 60K</span><br><span class="line">-rw-r--r--. 1 root root 57K Jun 14 06:43 b29vC10C0YaAXl0GAADglZ7FErM123.jpg</span><br></pre></td></tr></table></figure></p><h2 id="安装-Nginx"><a href="#安装-Nginx" class="headerlink" title="安装 Nginx"></a>安装 Nginx</h2><p>Nginx 只需要安装到 StorageServer 所在的服务器即可，用于访问文件。<br>单机部署 TrackerServer 和 StorageServer 在一台服务器上。</p><h3 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -c https://nginx.org/download/nginx-1.15.1.tar.gz</span><br></pre></td></tr></table></figure><p>解压<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.15.1.tar.gz</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd nginx-1.15.1</span><br></pre></td></tr></table></figure><p>使用默认配置<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br></pre></td></tr></table></figure></p><p>编译、安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p><p>启动 nginx<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx</span><br></pre></td></tr></table></figure><p>其他 nginx 命令：<br>停止 nginx 服务：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s stop</span><br></pre></td></tr></table></figure></p><p>退出 nginx 服务：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s quit</span><br></pre></td></tr></table></figure></p><p>重新加载 nginx 配置：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload</span><br></pre></td></tr></table></figure></p><p>设置 nginx 开机启动：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.local</span><br></pre></td></tr></table></figure></p><p>添加一行配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure></p><p>设置执行权限：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 755 /etc/rc.local</span><br></pre></td></tr></table></figure></p><p>查看 nginx 的版本和模块<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  sbin /usr/local/nginx/sbin/nginx -V</span><br><span class="line">nginx version: nginx/1.15.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC)</span><br><span class="line">configure arguments:</span><br></pre></td></tr></table></figure></p><p>在防火墙中开放 nginx 的默认 80 端口，本次虚拟机 CentOS 防火墙已完全关闭。</p><h3 id="配置-nginx"><a href="#配置-nginx" class="headerlink" title="配置 nginx"></a>配置 nginx</h3><p>修改 nginx.conf<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p><p>在<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">error_page   500 502 503 504  /50x.html;</span><br><span class="line">location = /50x.html &#123;</span><br><span class="line">    root   html;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>下方<br>添加如下配置，将 /group1/M00 映射到 /opt/fastdfs/file/data<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /group1/M00 &#123;</span><br><span class="line">    alias /opt/fastdfs/file/data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>重启 nginx<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s reload</span><br></pre></td></tr></table></figure></p><h3 id="测试访问图片"><a href="#测试访问图片" class="headerlink" title="测试访问图片"></a>测试访问图片</h3><p>在外面主机 macOS 的浏览器访问之前上传的图片。<br><a href="http://file.feeltens.com/group1/M00/00/00/b29vC10C0YaAXl0GAADglZ7FErM123.jpg" target="_blank" rel="noopener">http://file.feeltens.com/group1/M00/00/00/b29vC10C0YaAXl0GAADglZ7FErM123.jpg</a></p><h2 id="FastDFS-配置-Nginx-模块"><a href="#FastDFS-配置-Nginx-模块" class="headerlink" title="FastDFS 配置 Nginx 模块"></a>FastDFS 配置 Nginx 模块</h2><h3 id="fastdfs-nginx-module-模块说明"><a href="#fastdfs-nginx-module-模块说明" class="headerlink" title="fastdfs-nginx-module 模块说明"></a>fastdfs-nginx-module 模块说明</h3><p>FastDFS 通过 Tracker 服务器，将文件放在 Storage 服务器存储，但是同组存储服务器之间需要进行文件复制，有同步延迟的问题。<br>假设 Tracker 服务器将文件上传到了 192.168.51.128，上传成功后文件 ID 已经返回给客户端。<br>此时 FastDFS 存储集群机制，会将这个文件同步到同组存储 192.168.51.129。在文件还没有复制完成的情况下，客户端如果用这个文件 ID 在 192.168.51.129 上取文件，就会出现文件无法访问的错误。<br>而 fastdfs-nginx-module 可以重定向文件链接到源服务器取文件，避免客户端由于复制延迟导致的文件无法访问错误。</p><h3 id="安装配置-fastdfs-nginx-module"><a href="#安装配置-fastdfs-nginx-module" class="headerlink" title="安装配置 fastdfs-nginx-module"></a>安装配置 fastdfs-nginx-module</h3><p>下载 fastdfs-nginx-module<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/happyfish100/fastdfs-nginx-module/archive/5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip</span><br></pre></td></tr></table></figure><p>fastdfs-nginx-module 最新版的 master 与当前 nginx 有些版本问题，所以指定旧有稳定版本。</p><p>解压<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip</span><br></pre></td></tr></table></figure></p><p>重命名<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master</span><br></pre></td></tr></table></figure></p><p>配置 nginx<br>停止 nginx 服务<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -s stop</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder/nginx-1.15.1</span><br></pre></td></tr></table></figure><p>添加 fastdfs-nginx-module 模块<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --add-module=../fastdfs-nginx-module-master/src</span><br></pre></td></tr></table></figure></p><p>重新编译、安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p><p>查看 nginx 模块<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜  nginx-1.15.1 /usr/local/nginx/sbin/nginx -V</span><br><span class="line">nginx version: nginx/1.15.1</span><br><span class="line">built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC)</span><br><span class="line">configure arguments: --add-module=../fastdfs-nginx-module-master/src</span><br></pre></td></tr></table></figure></p><p>复制 fastdfs-nginx-module 源码中的配置文件到 /etc/fdfs 目录，并修改<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder/fastdfs-nginx-module-master/src</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp mod_fastdfs.conf /etc/fdfs/</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/mod_fastdfs.conf</span><br></pre></td></tr></table></figure><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 连接超时时间</span><br><span class="line">connect_timeout=10</span><br><span class="line"></span><br><span class="line"># Tracker Server</span><br><span class="line">tracker_server=file.feeltens.com:22122</span><br><span class="line"></span><br><span class="line"># StorageServer 默认端口</span><br><span class="line">storage_server_port=23000</span><br><span class="line"></span><br><span class="line"># 如果文件 ID 的 uri 中包含 /group**，则要设置为 true</span><br><span class="line">url_have_group_name = true</span><br><span class="line"></span><br><span class="line"># Storage 配置的 store_path0 路径，必须和 storage.conf 中的一致</span><br><span class="line">store_path0=/opt/fastdfs/file</span><br></pre></td></tr></table></figure></p><p>复制 FastDFS 的部分配置文件到 /etc/fdfs 目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder/fastdfs/conf/</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp anti-steal.jpg http.conf mime.types /etc/fdfs/</span><br></pre></td></tr></table></figure><p>配置 nginx，修改 nginx.conf<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure></p><p>修改配置：<br>注释掉刚刚添加的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /group1/M00 &#123;</span><br><span class="line">    alias /opt/fastdfs/file/data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>并在 80 端口下添加 fastdfs-nginx 模块<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location ~/group([0-9])/M00 &#123;</span><br><span class="line">    ngx_fastdfs_module;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190614000703.png" alt="fastdfs-nginx-config"><br>注意：<br><code>listen 80</code> 端口值是要与 <code>/etc/fdfs/storage.conf</code> 中的 <code>http.server_port=80</code> (前面改成 80 了) 相对应。如果改成其它端口，则需要统一，同时在防火墙中打开该端口。<br><code>location</code> 的配置，如果有多个 group 则配置 location ~/group([0-9])/M00 ，没有则不用配 group。</p><p>启动 nginx<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure></p><p>打印处如下就算配置成功。<br>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  conf /usr/local/nginx/sbin/nginx</span><br><span class="line">ngx_http_fastdfs_set pid=67575</span><br></pre></td></tr></table></figure></p><h3 id="测试访问图片-1"><a href="#测试访问图片-1" class="headerlink" title="测试访问图片"></a>测试访问图片</h3><p>在外面主机 macOS 的浏览器访问之前上传的图片。<br><a href="http://file.feeltens.com/group1/M00/00/00/b29vC10C0YaAXl0GAADglZ7FErM123.jpg" target="_blank" rel="noopener">http://file.feeltens.com/group1/M00/00/00/b29vC10C0YaAXl0GAADglZ7FErM123.jpg</a></p><p><img src="https://raw.githubusercontent.com/feeltens/vnote-resources/master/images/20190614001052.png" alt="FastDFS最终部署结构图"></p><h2 id="安装-FastDHT"><a href="#安装-FastDHT" class="headerlink" title="安装 FastDHT"></a>安装 FastDHT</h2><p>FastDFS 本身是不支持重复文件去重的。可以借助 <code>FastDHT</code> 来实现文件去重。<br>FastDHT 是分布式哈希系统（DHT），使用 Berkeley DB 做数据存储，使用 libevent 做网络 IO 处理。依赖于 libfastcommon。</p><h3 id="安装-Berkeley-DB"><a href="#安装-Berkeley-DB" class="headerlink" title="安装 Berkeley DB"></a>安装 Berkeley DB</h3><p>下载 berkeley-db<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://download.oracle.com/berkeley-db/db-6.0.30.tar.gz</span><br></pre></td></tr></table></figure><p>解压<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf db-6.0.30.tar.gz</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd db-6.0.30/build_unix</span><br></pre></td></tr></table></figure><p>进行提权：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 ../dist/configure</span><br></pre></td></tr></table></figure></p><p>选择安装目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../dist/configure --prefix=/usr</span><br></pre></td></tr></table></figure></p><p>编译、安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></p><p>安装完 db，会在 /usr/local 目录下生成 berkeley-db 目录。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/ &amp;&amp; ll</span><br></pre></td></tr></table></figure></p><p>berkeley-db 安装后的目录结构如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">/usr</span><br><span class="line">├── bin</span><br><span class="line">│   ├── db_archive</span><br><span class="line">│   ├── db_checkpoint</span><br><span class="line">│   ├── db_codegen</span><br><span class="line">│   ├── db_deadlock</span><br><span class="line">│   ├── db_dump</span><br><span class="line">│   ├── db_hotbackup</span><br><span class="line">│   ├── db_load</span><br><span class="line">│   ├── db_printlog</span><br><span class="line">│   ├── db_recover</span><br><span class="line">│   ├── db_stat</span><br><span class="line">│   ├── db_upgrade</span><br><span class="line">│   └── db_verify</span><br><span class="line">├── common</span><br><span class="line">│   ├── crypto_stub.c</span><br><span class="line">│   ├── db_byteorder.c</span><br><span class="line">│   ├── db_err.c</span><br><span class="line">│   ├── db_getlong.c</span><br><span class="line">│   ├── db_idspace.c</span><br><span class="line">│   ├── db_log2.c</span><br><span class="line">│   ├── db_shash.c</span><br><span class="line">│   ├── dbt.c</span><br><span class="line">│   ├── mkpath.c</span><br><span class="line">│   ├── openflags.c</span><br><span class="line">│   ├── os_method.c</span><br><span class="line">│   ├── tags -&gt; ../dist/tags</span><br><span class="line">│   ├── util_arg.c</span><br><span class="line">│   ├── util_cache.c</span><br><span class="line">│   ├── util_log.c</span><br><span class="line">│   ├── util_sig.c</span><br><span class="line">│   └── zerofill.c</span><br><span class="line">├── docs</span><br><span class="line">│   ├── api_c</span><br><span class="line">│   ├── api_cxx</span><br><span class="line">│   ├── api_tcl</span><br><span class="line">│   ├── articles</span><br><span class="line">│   ├── collections</span><br><span class="line">│   ├── gsg</span><br><span class="line">│   ├── gsg_db_rep</span><br><span class="line">│   ├── gsg_txn</span><br><span class="line">│   ├── images</span><br><span class="line">│   ├── java</span><br><span class="line">│   ├── license</span><br><span class="line">│   ├── porting</span><br><span class="line">│   ├── ref</span><br><span class="line">│   └── utility</span><br><span class="line">│   └── index.html</span><br><span class="line">├── include</span><br><span class="line">│   ├── db.h</span><br><span class="line">│   └── db_cxx.h</span><br><span class="line">└── lib</span><br><span class="line">    ├── libdb-6.0.a</span><br><span class="line">    ├── libdb-6.0.la</span><br><span class="line">    ├── libdb-6.0.so</span><br><span class="line">    ├── libdb-6.so -&gt; libdb-6.0.so</span><br><span class="line">    ├── libdb.a</span><br><span class="line">    └── libdb.so -&gt; libdb-6.0.so</span><br></pre></td></tr></table></figure></p><h3 id="下载安装-FastDHT"><a href="#下载安装-FastDHT" class="headerlink" title="下载安装 FastDHT"></a>下载安装 FastDHT</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /myfolder</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/happyfish100/fastdht.git</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd fastdht</span><br></pre></td></tr></table></figure><p>编译、安装<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./make.sh</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ./make.sh install</span><br></pre></td></tr></table></figure><p>最后会在 /usr/local/bin 生成安装后的文件，在 /etc/fdht 下生成配置文件。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/bin &amp;&amp; ll</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/fdht &amp;&amp; ll</span><br></pre></td></tr></table></figure><h3 id="配置-FastDHT"><a href="#配置-FastDHT" class="headerlink" title="配置 FastDHT"></a>配置 FastDHT</h3><p>创建 fastdht 目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -pm 775 /opt/fastdfs/fastdht</span><br></pre></td></tr></table></figure></p><p>修改 fdhtd.conf 文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdht/fdhtd.conf</span><br></pre></td></tr></table></figure></p><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">port=11411</span><br><span class="line">base_path=/opt/fastdfs/fastdht</span><br><span class="line"># 有 # 表示打开，如果想关闭此选项，则应该为 ## 开头。# 和 include 之间没有空格</span><br><span class="line">#include /etc/fdht/fdht_servers.conf</span><br></pre></td></tr></table></figure></p><p>修改 fdht_servers.conf 文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdht/fdht_servers.conf</span><br></pre></td></tr></table></figure></p><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 分组数量（数字可自定义）</span><br><span class="line">group_count = 1</span><br><span class="line">group0 = file.feeltens.com:11411</span><br><span class="line"># group0 = 192.168.224.224:11411</span><br><span class="line"># group1 = 192.168.224.223:11411</span><br><span class="line"># group1 = 192.168.224.224:11411</span><br></pre></td></tr></table></figure></p><p>修改 fdht_client.conf 文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdht/fdht_client.conf</span><br></pre></td></tr></table></figure></p><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># keep_alive=1 关联 storaged.conf 文件</span><br><span class="line">keep_alive=1</span><br><span class="line">base_path=/opt/fastdfs/fastdht</span><br><span class="line">#（注意： # 和 include 之间没有空格）</span><br><span class="line">#include /etc/fdht/fdht_servers.conf</span><br></pre></td></tr></table></figure></p><p>修改 storage.conf 文件<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/fdfs/storage.conf</span><br></pre></td></tr></table></figure></p><p>修改配置如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 是否检测上传文件已经存在。如果已经存在，则不存在文件内容，建立一个索引链接以节省磁盘空间</span><br><span class="line">check_file_duplicate=1</span><br><span class="line"># 当上个参数设定为1时，在 FastDHT 中的命名空间</span><br><span class="line">key_namespace=FastDFS</span><br><span class="line"># 长连接配置选项，如果为0则为短连接 1为长连接</span><br><span class="line">keep_alive=1</span><br><span class="line"># 可以通过 #include filename 方式来加载 FastDHT servers  的配置</span><br><span class="line"># 注意： # 和 include 之间没有空格</span><br><span class="line">#include /etc/fdht/fdht_servers.conf</span><br></pre></td></tr></table></figure></p><p>查看动态链接库是否全链接完毕<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd /usr/local/bin/fdhtd</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  fdht ldd /usr/local/bin/fdhtd</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffe52792000)</span><br><span class="line">        libdb-6.0.so =&gt; not found</span><br><span class="line">        libfastcommon.so =&gt; /lib/libfastcommon.so (0x00007f86dc518000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f86dc2fc000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f86dbf2f000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f86dbc2d000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f86dba29000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f86dc759000)</span><br></pre></td></tr></table></figure></p><p>提示缺少 libdb-6.0.so。<br>执行 ldconfig 命令：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldconfig</span><br></pre></td></tr></table></figure></p><p><code>ldconfig</code> 命令的用途，主要是在默认搜寻目录 (/lib 和 /usr/lib) 以及动态库配置文件 /etc/ld.so.conf 内所列的目录下，搜索出可共享的动态链接库 (格式如 lib.so)，进而创建出动态装入程序(ld.so) 所需的连接和缓存文件。缓存文件默认为 /etc/ld.so.cache，此文件保存已排好序的动态链接库名字列表。<br>再次查看动态链接库是否全链接完毕<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd /usr/local/bin/fdhtd</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜  fdht ldd /usr/local/bin/fdhtd</span><br><span class="line">        linux-vdso.so.1 =&gt;  (0x00007ffd26992000)</span><br><span class="line">        libdb-6.0.so =&gt; /lib/libdb-6.0.so (0x00007f8c3a3db000)</span><br><span class="line">        libfastcommon.so =&gt; /lib/libfastcommon.so (0x00007f8c3a19a000)</span><br><span class="line">        libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f8c39f7e000)</span><br><span class="line">        libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f8c39bb1000)</span><br><span class="line">        libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f8c398af000)</span><br><span class="line">        libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f8c396ab000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007f8c3a7b9000)</span><br></pre></td></tr></table></figure></p><h3 id="启动-FastDHT"><a href="#启动-FastDHT" class="headerlink" title="启动 FastDHT"></a>启动 FastDHT</h3><p>注意：要先启动 FastDHT，再启动 storage，才能使文件去重功能生效。</p><p>启动 FastDHT 命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdhtd /etc/fdht/fdhtd.conf</span><br></pre></td></tr></table></figure></p><p>重启 FastDHT 命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdhtd /etc/fdht/fdhtd.conf restart</span><br></pre></td></tr></table></figure></p><p>验证配置文件是否正确<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd restart</span><br><span class="line">fdhtd /etc/fdht/fdhtd.conf</span><br><span class="line">service fdfs_storaged restart</span><br><span class="line">/usr/local/bin/fdht_test /etc/fdht/fdht_client.conf</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/bin/fdht_test: Symbol `g_log_context&apos; has different size in shared object, consider re-linking</span><br><span class="line">fdht_get_sub_keys fail, errno: 95, error info: Operation not supported</span><br></pre></td></tr></table></figure></p><p>问题未解决，不过使用不受影响。TODO</p><p>查看端口是否启动<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep 11411</span><br></pre></td></tr></table></figure></p><p>显示结果如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  fdht netstat -an | grep 11411</span><br><span class="line">tcp        0      0 0.0.0.0:11411           0.0.0.0:*               LISTEN</span><br></pre></td></tr></table></figure></p><p>设置 FastDHT 开机自启<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.local</span><br></pre></td></tr></table></figure></p><p>加入以下配置：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fdhtd /etc/fdht/fdhtd.conf</span><br></pre></td></tr></table></figure></p><p>如果开启自启不生效，可能是 CentOS 找不到 fdhtd 文件。建议把全路径写上：/usr/local/bin/fdhtd /etc/fdht/fdhtd.conf。<br>执行命令，使之生效：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/rc.local</span><br></pre></td></tr></table></figure></p><h2 id="后续维护命令"><a href="#后续维护命令" class="headerlink" title="后续维护命令"></a>后续维护命令</h2><p>重启 FastDFS 的 tracker、storage 和 FastDHT<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service fdfs_trackerd start</span><br><span class="line">fdhtd /etc/fdht/fdhtd.conf restart</span><br><span class="line">service fdfs_storaged restart</span><br></pre></td></tr></table></figure></p><p>查看 FastDFS 和 FastDHT 运行状态<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -unltp | grep fdfs &amp;&amp; netstat -unltp | grep fdhtd</span><br></pre></td></tr></table></figure></p><p>查看 FastDFS 的 tracker、storage 和 FastDHT 的相关日志<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /opt/fastdfs/tracker/logs/trackerd.log</span><br></pre></td></tr></table></figure></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /opt/fastdfs/storage/logs/storaged.log</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail -f /opt/fastdfs/fastdht/logs/fdhtd.log</span><br></pre></td></tr></table></figure><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>用 FastDFS 一步步搭建文件管理系统 - bojiangzhou - 博客园<br><a href="https://www.cnblogs.com/chiangchou/p/fastdfs.html" target="_blank" rel="noopener">https://www.cnblogs.com/chiangchou/p/fastdfs.html</a><br>【FastDFS】FastDFS+FastDHT 完成文件上传去重 - 柠檬树 - CSDN 博客<br><a href="https://blog.csdn.net/qq_26545305/article/details/80071256" target="_blank" rel="noopener">https://blog.csdn.net/qq_26545305/article/details/80071256</a><br>fastdht github install 说明文档<br><a href="https://github.com/happyfish100/fastdht/blob/master/INSTALL" target="_blank" rel="noopener">https://github.com/happyfish100/fastdht/blob/master/INSTALL</a><br>Oracle Berkeley DB - Previous Releases<br><a href="https://www.oracle.com/technetwork/database/database-technologies/berkeleydb/downloads/index-082944.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/database/database-technologies/berkeleydb/downloads/index-082944.html</a><br>[FastDFS] FastDFS FAQ<br><a href="http://bbs.chinaunix.net/thread-1920470-1-1.html" target="_blank" rel="noopener">http://bbs.chinaunix.net/thread-1920470-1-1.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;环境准备&quot;&gt;&lt;a href=&quot;#环境准备&quot; class=&quot;headerlink&quot; title=&quot;环境准备&quot;&gt;&lt;/a&gt;环境准备&lt;/h2&gt;&lt;p&gt;虚拟机 CentOS-7 ip：111.111.111.11&lt;br&gt;本地 macOS&lt;/p&gt;
&lt;p&gt;修改 CentOS hosts&lt;br&gt;配置 hosts，将文件服务器的 ip 与域名映射。后期配置可以直接使用 &lt;code&gt;file.feeltens.com&lt;/code&gt; 去配置服务器地址。&lt;br&gt;ip 变了，就只需要修改 hosts 即可。&lt;/p&gt;
&lt;figure class=&quot;highlight shell&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;sudo vim /etc/hosts&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;添加如下配置：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;# FastDfs&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111.111.111.11 file.feeltens.com&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;本地 macOS 访问虚拟机里面的 FastDFS，也需要修改 hosts。&lt;/p&gt;
    
    </summary>
    
      <category term="Dev" scheme="http://www.feeltens.com/categories/Dev/"/>
    
    
      <category term="FastDFS" scheme="http://www.feeltens.com/tags/FastDFS/"/>
    
      <category term="CentOS" scheme="http://www.feeltens.com/tags/CentOS/"/>
    
  </entry>
  
  <entry>
    <title>关于 feeltens</title>
    <link href="http://www.feeltens.com/about/"/>
    <id>http://www.feeltens.com/about/</id>
    <published>2019-07-07T21:47:50.000Z</published>
    <updated>2020-11-20T13:31:11.160Z</updated>
    
    <content type="html"><![CDATA[<h2 id="feeltens-命名来源"><a href="#feeltens-命名来源" class="headerlink" title="feeltens 命名来源"></a>feeltens 命名来源</h2><p>feeltens = feel + ten + s</p><ul><li>feel 是触摸世界、感知世界的意思。</li><li>ten 是 1 和 0 的组合。</li><li>s 是「xx 化」的意思，on the way，勇于自我革新。</li></ul><a id="more"></a><h2 id="博客的用途"><a href="#博客的用途" class="headerlink" title="博客的用途"></a>博客的用途</h2><ul><li>记录学习笔记</li><li>分享技术感悟</li><li>如有可能，寻三五好友</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;feeltens-命名来源&quot;&gt;&lt;a href=&quot;#feeltens-命名来源&quot; class=&quot;headerlink&quot; title=&quot;feeltens 命名来源&quot;&gt;&lt;/a&gt;feeltens 命名来源&lt;/h2&gt;&lt;p&gt;feeltens = feel + ten + s&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;feel 是触摸世界、感知世界的意思。&lt;/li&gt;
&lt;li&gt;ten 是 1 和 0 的组合。&lt;/li&gt;
&lt;li&gt;s 是「xx 化」的意思，on the way，勇于自我革新。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://www.feeltens.com/hello-world/"/>
    <id>http://www.feeltens.com/hello-world/</id>
    <published>2019-07-07T09:00:00.000Z</published>
    <updated>2020-11-20T13:31:11.162Z</updated>
    
    <content type="html"><![CDATA[<p>学习，其实只不过是一种生活方式，否则为什么会有的人就是停不下来呢？学习不需要坚持、不需要毅力、不需要信念，不需要各种「不得已而为之的概念」，它只不过是一种选择，一个一旦真选了就再也不可逆的选择。仅此而已。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (alive) &#123;</span><br><span class="line">    learn();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;学习，其实只不过是一种生活方式，否则为什么会有的人就是停不下来呢？学习不需要坚持、不需要毅力、不需要信念，不需要各种「不得已而为之的概念」，它只不过是一种选择，一个一旦真选了就再也不可逆的选择。仅此而已。&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;
      
    
    </summary>
    
    
  </entry>
  
</feed>
